<!DOCTYPE html>
<html lang="ca">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lunagestio - Gesti√≥ Integral</title>
    
    <!-- Firebase SDK v9 -->
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js';
        import { getFirestore } from 'https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js';
        
        const firebaseConfig = {
            apiKey: "AIzaSyCbzW8zQkUPH4JY9Qc-DAboH2XER_IJQjI",
            authDomain: "luna-gestion.firebaseapp.com",
            projectId: "luna-gestion",
            storageBucket: "luna-gestion.firebasestorage.app",
            messagingSenderId: "5549836438",
            appId: "1:5549836438:web:be38e0d9a3a9b458635ab7"
        };

        try {
            const app = initializeApp(firebaseConfig);
            window.db = getFirestore(app);
            console.log('‚úÖ Firebase inicialitzat correctament');
        } catch (error) {
            console.error('‚ùå Error inicialitzaci√≥ Firebase:', error);
        }
    </script>

    <!-- Font Awesome local fallback -->
    <style>
        /* Font Awesome Icons Fallback */
        .fas, .far, .fa {
            font-family: 'Font Awesome 6 Free';
            font-weight: 900;
        }
        
        .fa-user-circle:before { content: "üë§"; }
        .fa-sync-alt:before { content: "üîÑ"; }
        .fa-bell:before { content: "üîî"; }
        .fa-sign-out-alt:before { content: "üö™"; }
        .fa-sign-in-alt:before { content: "üîë"; }
        .fa-user-plus:before { content: "üë•"; }
        .fa-calendar-check:before { content: "üìÖ"; }
        .fa-paper-plane:before { content: "‚úâÔ∏è"; }
        .fa-search:before { content: "üîç"; }
        .fa-map-marker-alt:before { content: "üìç"; }
        .fa-phone:before { content: "üìû"; }
        .fa-envelope:before { content: "‚úâÔ∏è"; }
        .fa-clock:before { content: "‚è∞"; }
        .fa-shield-alt:before { content: "üõ°Ô∏è"; }
        .fa-info-circle:before { content: "‚ÑπÔ∏è"; }
        .fa-bars:before { content: "‚ò∞"; }
        .fa-circle:before { content: "‚óè"; }
        .fa-envelope-open:before { content: "üì¨"; }
    </style>

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            line-height: 1.6;
            color: #333;
            background: #f8f9fa;
        }

        .header {
            background: linear-gradient(135deg, #2c3e50, #3498db);
            color: white;
            padding: 1rem 0;
            position: fixed;
            width: 100%;
            top: 0;
            z-index: 1000;
            box-shadow: 0 2px 20px rgba(0,0,0,0.1);
        }

        .nav-container {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 1rem;
        }

        .logo {
            font-size: 1.5rem;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .nav-links {
            display: flex;
            list-style: none;
            gap: 1rem;
            align-items: center;
        }

        .nav-links a {
            color: white;
            text-decoration: none;
            transition: all 0.3s ease;
            font-weight: 500;
            padding: 0.5rem 1rem;
            border-radius: 5px;
            white-space: nowrap;
        }

        .nav-links a:hover {
            background: rgba(255,255,255,0.1);
        }

        .language-selector {
            display: flex;
            gap: 0.3rem;
            background: rgba(255,255,255,0.1);
            padding: 0.3rem;
            border-radius: 8px;
        }

        .lang-btn {
            background: transparent;
            border: none;
            color: white;
            padding: 0.4rem 0.8rem;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 0.8rem;
            font-weight: bold;
        }

        .lang-btn:hover, .lang-btn.active {
            background: #f39c12;
            transform: scale(1.05);
        }

        .auth-buttons {
            display: flex;
            gap: 0.5rem;
            align-items: center;
        }

        .btn-auth {
            color: white;
            text-decoration: none;
            padding: 0.6rem 1rem;
            border-radius: 6px;
            transition: all 0.3s;
            font-size: 0.9rem;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            border: none;
            cursor: pointer;
        }

        .btn-login {
            background: #27ae60;
        }

        .btn-register {
            background: #3498db;
        }

        .btn-sync {
            background: #9b59b6;
        }

        .btn-logout {
            background: #e74c3c;
        }

        .btn-notification {
            background: #e67e22;
            position: relative;
        }

        .btn-auth:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .user-welcome {
            color: white;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-right: 1rem;
        }

        /* Styles pour la notification */
        .notification-badge {
            position: absolute;
            top: -8px;
            right: -8px;
            background: #e74c3c;
            color: white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            font-size: 0.7rem;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        /* Modal des messages */
        .modal {
            display: none;
            position: fixed;
            z-index: 2000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
        }

        .modal-content {
            background-color: white;
            margin: 5% auto;
            padding: 2rem;
            border-radius: 15px;
            width: 90%;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid #ecf0f1;
        }

        .modal-header h3 {
            color: #2c3e50;
            margin: 0;
        }

        .close-modal {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #7f8c8d;
            padding: 0.5rem;
        }

        .close-modal:hover {
            color: #e74c3c;
        }

        .message-list {
            max-height: 400px;
            overflow-y: auto;
        }

        .message-item {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 1.5rem;
            margin-bottom: 1rem;
            border-left: 4px solid #3498db;
            transition: all 0.3s;
        }

        .message-item:hover {
            transform: translateX(5px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .message-item.unread {
            background: #e8f4fd;
            border-left-color: #e74c3c;
        }

        .message-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 1rem;
        }

        .message-sender {
            font-weight: bold;
            color: #2c3e50;
        }

        .message-date {
            color: #7f8c8d;
            font-size: 0.9rem;
        }

        .message-subject {
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 0.5rem;
            font-size: 1.1rem;
        }

        .message-content {
            color: #34495e;
            line-height: 1.6;
            margin-bottom: 1rem;
        }

        .message-type {
            display: inline-block;
            background: #3498db;
            color: white;
            padding: 0.3rem 0.8rem;
            border-radius: 15px;
            font-size: 0.8rem;
            font-weight: bold;
        }

        .message-type.confirmation { background: #27ae60; }
        .message-type.cancellation { background: #e74c3c; }
        .message-type.information { background: #3498db; }
        .message-type.reminder { background: #f39c12; }
        .message-type.other { background: #9b59b6; }

        .no-messages {
            text-align: center;
            padding: 3rem;
            color: #7f8c8d;
        }

        .no-messages i {
            font-size: 3rem;
            margin-bottom: 1rem;
            opacity: 0.5;
        }

        .hero {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 8rem 1rem 4rem;
            text-align: center;
            margin-top: 60px;
        }

        .hero-content h1 {
            font-size: 2.5rem;
            margin-bottom: 1rem;
        }

        .hero-content p {
            font-size: 1.2rem;
            margin-bottom: 2rem;
            opacity: 0.9;
        }

        .btn {
            background: #f39c12;
            color: white;
            padding: 1rem 2rem;
            border: none;
            border-radius: 8px;
            font-size: 1.1rem;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(243, 156, 18, 0.4);
        }

        .services {
            padding: 4rem 1rem;
            max-width: 1200px;
            margin: 0 auto;
        }

        .section-title {
            text-align: center;
            font-size: 2.5rem;
            color: #2c3e50;
            margin-bottom: 3rem;
        }

        .services-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 2rem;
        }

        .service-card {
            background: white;
            padding: 2rem;
            border-radius: 15px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
            transition: transform 0.3s;
        }

        .service-card:hover {
            transform: translateY(-5px);
        }

        .service-icon {
            font-size: 3rem;
            margin-bottom: 1rem;
        }

        .service-card h3 {
            color: #2c3e50;
            margin-bottom: 1rem;
            font-size: 1.5rem;
        }

        .service-description {
            color: #7f8c8d;
            margin-bottom: 1.5rem;
            line-height: 1.6;
        }

        .service-features {
            list-style: none;
        }

        .service-features li {
            padding: 0.5rem 0;
            border-bottom: 1px solid #ecf0f1;
            color: #34495e;
        }

        .service-features li:before {
            content: "‚úì";
            color: #27ae60;
            font-weight: bold;
            margin-right: 0.5rem;
        }

        .appointment-section {
            background: #ecf0f1;
            padding: 4rem 1rem;
        }

        .appointment-form {
            max-width: 600px;
            margin: 0 auto;
            background: white;
            padding: 2rem;
            border-radius: 15px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            color: #2c3e50;
            font-weight: bold;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 1rem;
            border: 2px solid #bdc3c7;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            border-color: #3498db;
            outline: none;
        }

        .availability-info {
            background: #e8f4fd;
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 2rem;
            border-left: 4px solid #3498db;
        }

        .appointment-query-section {
            padding: 4rem 1rem;
            max-width: 800px;
            margin: 0 auto;
        }

        .contact-info {
            padding: 4rem 1rem;
            background: #2c3e50;
            color: white;
        }

        .contact-grid {
            max-width: 1200px;
            margin: 0 auto;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 2rem;
        }

        .contact-card {
            text-align: center;
            padding: 2rem;
        }

        .contact-card i {
            font-size: 2.5rem;
            margin-bottom: 1rem;
            color: #3498db;
        }

        .footer {
            background: #34495e;
            color: white;
            text-align: center;
            padding: 2rem 1rem;
        }

        .success-message {
            background: #d4edda;
            color: #155724;
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 1rem;
            border: 1px solid #c3e6cb;
        }

        .error-message {
            background: #f8d7da;
            color: #721c24;
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 1rem;
            border: 1px solid #f5c6cb;
        }

        .mobile-menu-btn {
            display: none;
            background: none;
            border: none;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
        }

        /* Styles pour la section de connexion */
        .login-section {
            padding: 6rem 1rem 4rem;
            max-width: 500px;
            margin: 0 auto;
        }

        .login-form {
            background: white;
            padding: 2rem;
            border-radius: 15px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
        }

        .form-title {
            text-align: center;
            margin-bottom: 2rem;
            color: #2c3e50;
        }

        /* Styles pour l'affichage des rendez-vous */
        .appointments-container {
            margin-top: 2rem;
        }

        .appointment-card {
            background: white;
            border-radius: 10px;
            padding: 1.5rem;
            margin-bottom: 1rem;
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
            border-left: 4px solid #3498db;
        }

        .appointment-card.confirmed {
            border-left-color: #27ae60;
        }

        .appointment-card.pending {
            border-left-color: #f39c12;
        }

        .appointment-card.cancelled {
            border-left-color: #e74c3c;
        }

        .appointment-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .appointment-service {
            font-weight: bold;
            color: #2c3e50;
            font-size: 1.1rem;
        }

        .appointment-status {
            padding: 0.3rem 0.8rem;
            border-radius: 15px;
            font-size: 0.8rem;
            font-weight: bold;
            color: white;
        }

        .status-confirmed {
            background: #27ae60;
        }

        .status-pending {
            background: #f39c12;
        }

        .status-cancelled {
            background: #e74c3c;
        }

        .appointment-details {
            color: #7f8c8d;
            margin-bottom: 1rem;
        }

        .appointment-actions {
            display: flex;
            gap: 0.5rem;
        }

        .btn-action {
            padding: 0.5rem 1rem;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.3s;
        }

        .btn-cancel {
            background: #e74c3c;
            color: white;
        }

        .btn-reschedule {
            background: #3498db;
            color: white;
        }

        .btn-action:hover {
            opacity: 0.9;
            transform: translateY(-2px);
        }

        .appointments-stats {
            display: flex;
            justify-content: space-between;
            margin-bottom: 2rem;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .stat-card {
            background: white;
            padding: 1.5rem;
            border-radius: 10px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
            flex: 1;
            min-width: 150px;
            text-align: center;
        }

        .stat-number {
            font-size: 2rem;
            font-weight: bold;
            color: #2c3e50;
        }

        .stat-label {
            color: #7f8c8d;
            margin-top: 0.5rem;
        }

        @media (max-width: 768px) {
            .mobile-menu-btn {
                display: block;
            }

            .nav-links {
                display: none;
                position: absolute;
                top: 100%;
                left: 0;
                width: 100%;
                background: #2c3e50;
                flex-direction: column;
                padding: 1rem;
            }

            .nav-links.active {
                display: flex;
            }

            .hero-content h1 {
                font-size: 2rem;
            }

            .section-title {
                font-size: 2rem;
            }

            .modal-content {
                margin: 10% auto;
                width: 95%;
                padding: 1.5rem;
            }

            .appointments-stats {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <nav class="nav-container">
            <div class="logo">
                <span data-i18n="nav.logo">Lunagestio</span>
            </div>
            
            <button class="mobile-menu-btn">
                <i class="fas fa-bars"></i>
            </button>

            <ul class="nav-links">
                <li><a href="#inici" data-i18n="nav.home">Inici</a></li>
                <li><a href="#serveis" data-i18n="nav.services">Serveis</a></li>
                <li><a href="#contacte" data-i18n="nav.contact">Contacte</a></li>
                <li><a href="#cites" data-i18n="nav.appointment">Cites</a></li>
                
                <!-- Selector d'idioma -->
                <li class="language-selector">
                    <button class="lang-btn active" data-lang="ca">CA</button>
                    <button class="lang-btn" data-lang="es">ES</button>
                    <button class="lang-btn" data-lang="fr">FR</button>
                    <button class="lang-btn" data-lang="en">EN</button>
                </li>
                
                <!-- Botons d'autenticaci√≥ (din√†mic) -->
                <li class="auth-buttons" id="authButtonsContainer">
                    <!-- Contingut carregat din√†micament -->
                </li>
            </ul>
        </nav>
    </header>

    <!-- Modal des messages -->
    <div id="messagesModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 data-i18n="messages.title">Missatges Rebuts</h3>
                <button class="close-modal" onclick="closeMessagesModal()">&times;</button>
            </div>
            <div id="messagesList" class="message-list">
                <!-- Messages charg√©s dynamiquement -->
            </div>
        </div>
    </div>

    <!-- Secci√≥ Hero -->
    <section class="hero" id="inici">
        <div class="hero-content">
            <h1 data-i18n="hero.title">Lunagestio - El Vostre Soci de Confian√ßa</h1>
            <p data-i18n="hero.subtitle">Serveis integrals de gesti√≥: Estrangeria, Fiscalitat, Comptabilitat i m√©s</p>
            <button class="btn" onclick="scrollToSection('cites')">
                <i class="fas fa-calendar-check"></i> <span data-i18n="hero.cta">Sol¬∑licitar Cita</span>
            </button>
        </div>
    </section>

    <!-- Secci√≥ Serveis -->
    <section class="services" id="serveis">
        <h2 class="section-title" data-i18n="services.title">Els Nostres Serveis</h2>
        <div class="services-grid">
            <!-- Servei d'Estrangeria -->
            <div class="service-card">
                <div class="service-icon">üåç</div>
                <h3 data-i18n="services.foreign.title">Estrangeria</h3>
                <p class="service-description" data-i18n="services.foreign.description">
                    Gesti√≥ completa de tr√†mits d'estrangeria per a residents internacionals. 
                    Assessorament especialitzat en permisos de resid√®ncia, treball, nacionalitat espanyola, 
                    reagrupaci√≥ familiar i traduccions jurades.
                </p>
                <ul class="service-features">
                    <li data-i18n="services.foreign.feature1">Permisos de resid√®ncia i treball</li>
                    <li data-i18n="services.foreign.feature2">Nacionalitat espanyola</li>
                    <li data-i18n="services.foreign.feature3">Reagrupaci√≥ familiar</li>
                    <li data-i18n="services.foreign.feature4">Traduccions jurades</li>
                    <li data-i18n="services.foreign.feature5">Assessorament legal migratori</li>
                </ul>
            </div>

            <!-- Servei Fiscal -->
            <div class="service-card">
                <div class="service-icon">üíº</div>
                <h3 data-i18n="services.labor.title">Fiscal / Comptable</h3>
                <p class="service-description" data-i18n="services.labor.description">
                    Solucions integrals per a empreses i aut√≤noms. Gesti√≥ de tota la 
                    documentaci√≥, n√≤mines, contractes, inscripcions a la Seguretat Social, 
                    aix√≠ com declaracions d'impostos i obligacions fiscals.
                </p>
                <ul class="service-features">
                    <li data-i18n="services.labor.feature1">Gesti√≥ de n√≤mines i contractes</li>
                    <li data-i18n="services.labor.feature2">Inscripcions Seguretat Social</li>
                    <li data-i18n="services.labor.feature3">Declaracions d'impostos</li>
                    <li data-i18n="services.labor.feature4">Assessorament fiscal</li>
                    <li data-i18n="services.labor.feature5">Comptabilitat per a empreses</li>
                </ul>
            </div>

            <!-- Servei d'Assegurances -->
            <div class="service-card">
                <div class="service-icon">üõ°Ô∏è</div>
                <h3 data-i18n="services.insurance.title">Assegurances</h3>
                <p class="service-description" data-i18n="services.insurance.description">
                    Trobeu les millors cobertures d'assegurances adaptades a les vostres necessitats espec√≠fiques. 
                    Treballem amb les principals companyies per oferir-vos assegurances 
                    d'habitatge, salut, vida, autom√≤bil i responsabilitat civil.
                </p>
                <ul class="service-features">
                    <li data-i18n="services.insurance.feature1">Assegurances d'habitatge</li>
                    <li data-i18n="services.insurance.feature2">Assegurances de salut i vida</li>
                    <li data-i18n="services.insurance.feature3">Assegurances d'autom√≤bil</li>
                    <li data-i18n="services.insurance.feature4">Responsabilitat civil</li>
                    <li data-i18n="services.insurance.feature5">Comparaci√≥ de companyies</li>
                </ul>
            </div>

            <!-- Servei Vehicles -->
            <div class="service-card">
                <div class="service-icon">üöó</div>
                <h3 data-i18n="services.vehicles.title">Vehicles</h3>
                <p class="service-description" data-i18n="services.vehicles.description">
                    Gesti√≥ de tots els tr√†mits relacionats amb el vostre vehicle de manera r√†pida i eficient. 
                    Des de transfer√®ncies i matriculacions fins a la ITV i permisos de circulaci√≥.
                </p>
                <ul class="service-features">
                    <li data-i18n="services.vehicles.feature1">Transfer√®ncies de vehicles</li>
                    <li data-i18n="services.vehicles.feature2">Matriculacions i ITV</li>
                    <li data-i18n="services.vehicles.feature3">Permisos de circulaci√≥</li>
                    <li data-i18n="services.vehicles.feature4">Baixes temporals/definitives</li>
                    <li data-i18n="services.vehicles.feature5">Gesti√≥ de multes</li>
                </ul>
            </div>
        </div>
    </section>

    <!-- Secci√≥ de Connexion -->
    <section class="login-section" id="login" style="display: none;">
        <div class="login-form">
            <h2 class="form-title" data-i18n="login.title">Iniciar Sessi√≥</h2>
            <div class="form-group">
                <label for="loginEmail" data-i18n="login.email">Email</label>
                <input type="email" id="loginEmail" required data-i18n="login.emailPlaceholder" placeholder="Introdu√Øu el vostre email">
            </div>
            <div class="form-group">
                <label for="loginPassword" data-i18n="login.password">Contrasenya</label>
                <input type="password" id="loginPassword" required data-i18n="login.passwordPlaceholder" placeholder="Introdu√Øu la vostra contrasenya">
            </div>
            <button class="btn" onclick="login()" id="loginBtn">
                <i class="fas fa-sign-in-alt"></i> <span data-i18n="login.button">Iniciar Sessi√≥</span>
            </button>
            <p style="text-align: center; margin-top: 1rem;">
                <span data-i18n="login.noAccount">No teniu un compte?</span>
                <a href="#" onclick="showRegister()" data-i18n="login.register">Registreu-vos aqu√≠</a>
            </p>
        </div>
    </section>

    <!-- Secci√≥ de Registre -->
    <section class="login-section" id="register" style="display: none;">
        <div class="login-form">
            <h2 class="form-title" data-i18n="register.title">Crear Compte</h2>
            <div class="form-group">
                <label for="registerFirstName" data-i18n="register.firstName">Nom</label>
                <input type="text" id="registerFirstName" required data-i18n="register.firstNamePlaceholder" placeholder="Introdu√Øu el vostre nom">
            </div>
            <div class="form-group">
                <label for="registerLastName" data-i18n="register.lastName">Cognom</label>
                <input type="text" id="registerLastName" required data-i18n="register.lastNamePlaceholder" placeholder="Introdu√Øu el vostre cognom">
            </div>
            <div class="form-group">
                <label for="registerEmail" data-i18n="register.email">Email</label>
                <input type="email" id="registerEmail" required data-i18n="register.emailPlaceholder" placeholder="Introdu√Øu el vostre email">
            </div>
            <div class="form-group">
                <label for="registerPassword" data-i18n="register.password">Contrasenya</label>
                <input type="password" id="registerPassword" required data-i18n="register.passwordPlaceholder" placeholder="Creeu una contrasenya">
            </div>
            <button class="btn" onclick="register()" id="registerBtn">
                <i class="fas fa-user-plus"></i> <span data-i18n="register.button">Crear Compte</span>
            </button>
            <p style="text-align: center; margin-top: 1rem;">
                <span data-i18n="register.haveAccount">Ja teniu un compte?</span>
                <a href="#" onclick="showLogin()" data-i18n="register.login">Inicieu sessi√≥ aqu√≠</a>
            </p>
        </div>
    </section>

    <!-- Secci√≥ Cites -->
    <section class="appointment-section" id="cites">
        <h2 class="section-title" data-i18n="appointment.title">Sol¬∑licitar una Cita</h2>
        <p data-i18n="appointment.subtitle">Reserveu la vostra consulta en l√≠nia</p>
        
        <div class="appointment-form">
            <div class="availability-info">
                <h4><i class="fas fa-info-circle"></i> <span data-i18n="availability.title">Horaris Disponibles</span></h4>
                <p data-i18n="availability.schedule">Dilluns-Dimarts: 10h-13h i 16h-19h | Dimecres-Divendres: 10h-15h</p>
                <p data-i18n="availability.closed">Tancat: caps de setmana i festius</p>
            </div>
            
            <div id="appointmentAuthCheck">
                <!-- Verificaci√≥ de connexi√≥ -->
            </div>
            
            <form id="appointmentForm" style="display: none;">
                <div class="form-group">
                    <label for="service" data-i18n="form.service">Servei sol¬∑licitat *</label>
                    <select id="service" required>
                        <option value="" data-i18n="form.selectService">Seleccioneu un servei</option>
                        <option value="extranjeria" data-i18n="services.foreign.title">Estrangeria</option>
                        <option value="laboral" data-i18n="services.labor.title">Fiscal / Comptable</option>
                        <option value="seguros" data-i18n="services.insurance.title">Assegurances</option>
                        <option value="vehiculos" data-i18n="services.vehicles.title">Vehicles</option>
                        <option value="otro" data-i18n="form.other">Altres</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="appointmentDate" data-i18n="form.selectDate">Data desitjada *</label>
                    <input type="date" id="appointmentDate" required>
                </div>
                
                <div class="form-group">
                    <label for="appointmentTime" data-i18n="form.selectTime">Hora *</label>
                    <select id="appointmentTime" required>
                        <option value="" data-i18n="form.selectTime">Seleccioneu una hora</option>
                        <!-- Els horaris es generaran din√†micament -->
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="message" data-i18n="form.message">Missatge (opcional)</label>
                    <textarea id="message" rows="4" data-i18n="form.messagePlaceholder" placeholder="Informaci√≥ addicional sobre la vostra consulta..."></textarea>
                </div>
                
                <button type="submit" class="btn" id="submitBtn">
                    <i class="fas fa-paper-plane"></i> <span data-i18n="form.submit">Confirmar la Cita</span>
                </button>
            </form>
        </div>
    </section>

    <!-- Secci√≥ de Gesti√≥ de Cites -->
    <section class="appointment-query-section" id="my-appointments" style="display: none;">
        <div class="appointment-form">
            <h2 data-i18n="myAppointments.title">Les Meves Cites</h2>
            <p data-i18n="myAppointments.subtitle">Gestioneu les vostres cites programades</p>
            
            <div class="appointments-stats" id="appointmentsStats">
                <!-- Estad√≠stiques de cites -->
            </div>
            
            <div id="appointmentsList" class="appointments-container">
                <!-- Llista de cites -->
            </div>
        </div>
    </section>

    <!-- Consulta de Cites -->
    <section class="appointment-query-section" id="consulta-cites">
        <div class="appointment-form">
            <h2 data-i18n="query.title">Consultar les Vostres Cites</h2>
            <p data-i18n="query.subtitle">Verifiqueu l'estat de les vostres cites programades</p>
            
            <div class="form-group">
                <label for="queryEmail" data-i18n="query.email">Email *</label>
                <input type="email" id="queryEmail" required data-i18n="query.emailPlaceholder" placeholder="Introdu√Øu l'email utilitzat per a la reserva">
            </div>
            
            <button class="btn btn-secondary" onclick="queryAppointments()" id="queryBtn">
                <i class="fas fa-search"></i> <span data-i18n="query.button">Consultar Cites</span>
            </button>
            
            <div id="appointmentsResults" style="margin-top: 2rem;"></div>
        </div>
    </section>

    <!-- Secci√≥ Contacte -->
    <section class="contact-info" id="contacte">
        <h2 class="section-title" data-i18n="contact.title">Contacte</h2>
        <div class="contact-grid">
            <div class="contact-card">
                <i class="fas fa-map-marker-alt"></i>
                <h3 data-i18n="contact.address">Adre√ßa</h3>
                <p>C/ Sant Marti 17<br>Palafrugell, Spain, 17200</p>
            </div>
            <div class="contact-card">
                <i class="fas fa-phone"></i>
                <h3 data-i18n="contact.phone">Tel√®fon</h3>
                <p>+34 972 30 43 09<br>640 56 48 54 / 678 13 94 21</p>
            </div>
            <div class="contact-card">
                <i class="fas fa-envelope"></i>
                <h3 data-i18n="contact.email">Email</h3>
                <p>info@lunagestio.com</p>
            </div>
            <div class="contact-card">
                <i class="fas fa-clock"></i>
                <h3 data-i18n="contact.hours.title">Horari</h3>
                <p data-i18n="contact.hours.monday">Dilluns-Dimarts: 10h-13h i 16h-19h</p>
                <p data-i18n="contact.hours.wednesday">Dimecres-Divendres: 10h-15h</p>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="footer">
        <p>&copy; 2024 Lunagestio. <span data-i18n="footer.rights">Tots els drets reservats.</span></p>
        <p style="margin-top: 1rem; opacity: 0.8;">
            <i class="fas fa-shield-alt"></i> <span data-i18n="footer.privacy">La vostra privadesa √©s important per a nosaltres</span>
        </p>
    </footer>

    <script>
        // ===== SISTEMA DE TRADUCCIONS COMPLET =====
        const translations = {
            ca: {
                "nav.logo": "Lunagestio",
                "nav.home": "Inici",
                "nav.services": "Serveis",
                "nav.contact": "Contacte",
                "nav.appointment": "Cites",
                
                "auth.login": "Iniciar sessi√≥",
                "auth.register": "Registre",
                "auth.logout": "Tancar sessi√≥",
                "auth.sync": "Sincronitzar",
                "auth.welcome": "Hola",
                "auth.notifications": "Notificacions",
                "auth.adminMode": "Mode Administrador",
                "auth.adminMessage": "Esteu connectat com a administrador. Per sol¬∑licitar una cita, utilitzeu un compte de client.",
                "auth.changeAccount": "Canviar de compte",
                "auth.connected": "Connectat",
                "auth.canBook": "Ara podeu sol¬∑licitar una cita.",
                "auth.loginRequired": "Connexi√≥ Requerida",
                "auth.loginMessage": "Heu d'estar connectat per sol¬∑licitar una cita.",
                
                "login.title": "Iniciar Sessi√≥",
                "login.email": "Email",
                "login.emailPlaceholder": "Introdu√Øu el vostre email",
                "login.password": "Contrasenya",
                "login.passwordPlaceholder": "Introdu√Øu la vostra contrasenya",
                "login.button": "Iniciar Sessi√≥",
                "login.noAccount": "No teniu un compte?",
                "login.register": "Registreu-vos aqu√≠",
                
                "register.title": "Crear Compte",
                "register.firstName": "Nom",
                "register.firstNamePlaceholder": "Introdu√Øu el vostre nom",
                "register.lastName": "Cognom",
                "register.lastNamePlaceholder": "Introdu√Øu el vostre cognom",
                "register.email": "Email",
                "register.emailPlaceholder": "Introdu√Øu el vostre email",
                "register.password": "Contrasenya",
                "register.passwordPlaceholder": "Creeu una contrasenya",
                "register.button": "Crear Compte",
                "register.haveAccount": "Ja teniu un compte?",
                "register.login": "Inicieu sessi√≥ aqu√≠",
                
                "messages.title": "Missatges Rebuts",
                "messages.noMessages": "No teniu cap missatge nou",
                "messages.from": "De",
                "messages.date": "Data",
                "messages.type": "Tipus",
                "messages.confirmation": "Confirmaci√≥",
                "messages.cancellation": "Cancel¬∑laci√≥",
                "messages.information": "Informaci√≥",
                "messages.reminder": "Recordatori",
                "messages.other": "Altres",
                "messages.unread": "No llegit",
                
                "hero.title": "Lunagestio - El Vostre Soci de Confian√ßa",
                "hero.subtitle": "Serveis integrals de gesti√≥: Estrangeria, Fiscalitat, Comptabilitat i m√©s",
                "hero.cta": "Sol¬∑licitar Cita",
                
                "services.title": "Els Nostres Serveis",
                "services.foreign.title": "Estrangeria",
                "services.foreign.description": "Gesti√≥ completa de tr√†mits d'estrangeria per a residents internacionals.",
                "services.foreign.feature1": "Permisos de resid√®ncia i treball",
                "services.foreign.feature2": "Nacionalitat espanyola",
                "services.foreign.feature3": "Reagrupaci√≥ familiar",
                "services.foreign.feature4": "Traduccions jurades",
                "services.foreign.feature5": "Assessorament legal migratori",
                
                "services.labor.title": "Fiscal / Comptable",
                "services.labor.description": "Solucions integrals per a empreses i aut√≤noms.",
                "services.labor.feature1": "Gesti√≥ de n√≤mines i contractes",
                "services.labor.feature2": "Inscripcions Seguretat Social",
                "services.labor.feature3": "Declaracions d'impostos",
                "services.labor.feature4": "Assessorament fiscal",
                "services.labor.feature5": "Comptabilitat per a empreses",
                
                "services.insurance.title": "Assegurances",
                "services.insurance.description": "Trobeu les millors cobertures d'assegurances.",
                "services.insurance.feature1": "Assegurances d'habitatge",
                "services.insurance.feature2": "Assegurances de salut i vida",
                "services.insurance.feature3": "Assegurances d'autom√≤bil",
                "services.insurance.feature4": "Responsabilitat civil",
                "services.insurance.feature5": "Comparaci√≥ de companyies",
                
                "services.vehicles.title": "Vehicles",
                "services.vehicles.description": "Gesti√≥ de tots els tr√†mits relacionats amb el vostre vehicle.",
                "services.vehicles.feature1": "Transfer√®ncies de vehicles",
                "services.vehicles.feature2": "Matriculacions i ITV",
                "services.vehicles.feature3": "Permisos de circulaci√≥",
                "services.vehicles.feature4": "Baixes temporals/definitives",
                "services.vehicles.feature5": "Gesti√≥ de multes",
                
                "appointment.title": "Sol¬∑licitar una Cita",
                "appointment.subtitle": "Reserveu la vostra consulta en l√≠nia",
                
                "availability.title": "Horaris Disponibles",
                "availability.schedule": "Dilluns-Dimarts: 10h-13h i 16h-19h | Dimecres-Divendres: 10h-15h",
                "availability.closed": "Tancat: caps de setmana i festius",
                
                "form.service": "Servei sol¬∑licitat *",
                "form.selectService": "Seleccioneu un servei",
                "form.selectDate": "Data desitjada *",
                "form.selectTime": "Hora *",
                "form.message": "Missatge (opcional)",
                "form.messagePlaceholder": "Informaci√≥ addicional sobre la vostra consulta...",
                "form.other": "Altres",
                "form.submit": "Confirmar la Cita",
                
                "myAppointments.title": "Les Meves Cites",
                "myAppointments.subtitle": "Gestioneu les vostres cites programades",
                "myAppointments.total": "Total",
                "myAppointments.confirmed": "Confirmades",
                "myAppointments.pending": "Pendents",
                "myAppointments.cancelled": "Cancel¬∑lades",
                "myAppointments.noAppointments": "No teniu cap cita programada",
                "myAppointments.service": "Servei",
                "myAppointments.date": "Data",
                "myAppointments.time": "Hora",
                "myAppointments.status": "Estat",
                "myAppointments.cancel": "Cancel¬∑lar",
                "myAppointments.reschedule": "Reprogramar",
                
                "query.title": "Consultar les Vostres Cites",
                "query.subtitle": "Verifiqueu l'estat de les vostres cites programades",
                "query.email": "Email *",
                "query.emailPlaceholder": "Introdu√Øu l'email utilitzat per a la reserva",
                "query.button": "Consultar Cites",
                
                "contact.title": "Contacte",
                "contact.address": "Adre√ßa",
                "contact.phone": "Tel√®fon",
                "contact.email": "Email",
                "contact.hours.title": "Horari",
                "contact.hours.monday": "Dilluns-Dimarts: 10h-13h i 16h-19h",
                "contact.hours.wednesday": "Dimecres-Divendres: 10h-15h",
                
                "footer.rights": "Tots els drets reservats.",
                "footer.privacy": "La vostra privadesa √©s important per a nosaltres"
            },
            es: {
                "nav.logo": "Lunagestio",
                "nav.home": "Inicio",
                "nav.services": "Servicios",
                "nav.contact": "Contacto",
                "nav.appointment": "Citas",
                
                "auth.login": "Iniciar sesi√≥n",
                "auth.register": "Registro",
                "auth.logout": "Cerrar sesi√≥n",
                "auth.sync": "Sincronizar",
                "auth.welcome": "Hola",
                "auth.notifications": "Notificaciones",
                "auth.adminMode": "Modo Administrador",
                "auth.adminMessage": "Est√° conectado como administrador. Para solicitar una cita, utilice una cuenta de cliente.",
                "auth.changeAccount": "Cambiar de cuenta",
                "auth.connected": "Conectado",
                "auth.canBook": "Ahora puede solicitar una cita.",
                "auth.loginRequired": "Conexi√≥n Requerida",
                "auth.loginMessage": "Debe estar conectado para solicitar una cita.",
                
                "login.title": "Iniciar Sesi√≥n",
                "login.email": "Email",
                "login.emailPlaceholder": "Introduzca su email",
                "login.password": "Contrase√±a",
                "login.passwordPlaceholder": "Introduzca su contrase√±a",
                "login.button": "Iniciar Sesi√≥n",
                "login.noAccount": "¬øNo tiene una cuenta?",
                "login.register": "Reg√≠strese aqu√≠",
                
                "register.title": "Crear Cuenta",
                "register.firstName": "Nombre",
                "register.firstNamePlaceholder": "Introduzca su nombre",
                "register.lastName": "Apellido",
                "register.lastNamePlaceholder": "Introduzca su apellido",
                "register.email": "Email",
                "register.emailPlaceholder": "Introduzca su email",
                "register.password": "Contrase√±a",
                "register.passwordPlaceholder": "Cree una contrase√±a",
                "register.button": "Crear Cuenta",
                "register.haveAccount": "¬øYa tiene una cuenta?",
                "register.login": "Inicie sesi√≥n aqu√≠",
                
                "messages.title": "Mensajes Recibidos",
                "messages.noMessages": "No tiene ning√∫n mensaje nuevo",
                "messages.from": "De",
                "messages.date": "Fecha",
                "messages.type": "Tipo",
                "messages.confirmation": "Confirmaci√≥n",
                "messages.cancellation": "Cancelaci√≥n",
                "messages.information": "Informaci√≥n",
                "messages.reminder": "Recordatorio",
                "messages.other": "Otros",
                "messages.unread": "No le√≠do",
                
                "hero.title": "Lunagestio - Su Socio de Confianza",
                "hero.subtitle": "Servicios integrales de gesti√≥n: Extranjer√≠a, Fiscalidad, Contabilidad y m√°s",
                "hero.cta": "Solicitar Cita",
                
                "services.title": "Nuestros Servicios",
                "services.foreign.title": "Extranjer√≠a",
                "services.foreign.description": "Gesti√≥n completa de tr√°mites de extranjer√≠a para residentes internacionales.",
                "services.foreign.feature1": "Permisos de residencia y trabajo",
                "services.foreign.feature2": "Nacionalidad espa√±ola",
                "services.foreign.feature3": "Reagrupaci√≥n familiar",
                "services.foreign.feature4": "Traducciones juradas",
                "services.foreign.feature5": "Asesoramiento legal migratorio",
                
                "services.labor.title": "Fiscal / Contable",
                "services.labor.description": "Soluciones integrales para empresas y aut√≥nomos.",
                "services.labor.feature1": "Gesti√≥n de n√≥minas y contratos",
                "services.labor.feature2": "Inscripciones Seguridad Social",
                "services.labor.feature3": "Declaraciones de impuestos",
                "services.labor.feature4": "Asesoramiento fiscal",
                "services.labor.feature5": "Contabilidad para empresas",
                
                "services.insurance.title": "Seguros",
                "services.insurance.description": "Encuentre las mejores coberturas de seguros.",
                "services.insurance.feature1": "Seguros de hogar",
                "services.insurance.feature2": "Seguros de salud y vida",
                "services.insurance.feature3": "Seguros de autom√≥vil",
                "services.insurance.feature4": "Responsabilidad civil",
                "services.insurance.feature5": "Comparaci√≥n de compa√±√≠as",
                
                "services.vehicles.title": "Veh√≠culos",
                "services.vehicles.description": "Gesti√≥n de todos los tr√°mites relacionados con su veh√≠culo.",
                "services.vehicles.feature1": "Transferencias de veh√≠culos",
                "services.vehicles.feature2": "Matriculaciones e ITV",
                "services.vehicles.feature3": "Permisos de circulaci√≥n",
                "services.vehicles.feature4": "Bajas temporales/definitivas",
                "services.vehicles.feature5": "Gesti√≥n de multas",
                
                "appointment.title": "Solicitar una Cita",
                "appointment.subtitle": "Reserve su consulta en l√≠nea",
                
                "availability.title": "Horarios Disponibles",
                "availability.schedule": "Lunes-Martes: 10h-13h y 16h-19h | Mi√©rcoles-Viernes: 10h-15h",
                "availability.closed": "Cerrado: fines de semana y festivos",
                
                "form.service": "Servicio solicitado *",
                "form.selectService": "Seleccione un servicio",
                "form.selectDate": "Fecha deseada *",
                "form.selectTime": "Hora *",
                "form.message": "Mensaje (opcional)",
                "form.messagePlaceholder": "Informaci√≥n adicional sobre su consulta...",
                "form.other": "Otros",
                "form.submit": "Confirmar la Cita",
                
                "myAppointments.title": "Mis Citas",
                "myAppointments.subtitle": "Gestione sus citas programadas",
                "myAppointments.total": "Total",
                "myAppointments.confirmed": "Confirmadas",
                "myAppointments.pending": "Pendientes",
                "myAppointments.cancelled": "Canceladas",
                "myAppointments.noAppointments": "No tiene ninguna cita programada",
                "myAppointments.service": "Servicio",
                "myAppointments.date": "Fecha",
                "myAppointments.time": "Hora",
                "myAppointments.status": "Estado",
                "myAppointments.cancel": "Cancelar",
                "myAppointments.reschedule": "Reprogramar",
                
                "query.title": "Consultar sus Citas",
                "query.subtitle": "Verifique el estado de sus citas programadas",
                "query.email": "Email *",
                "query.emailPlaceholder": "Introduzca el email utilizado para la reserva",
                "query.button": "Consultar Citas",
                
                "contact.title": "Contacto",
                "contact.address": "Direcci√≥n",
                "contact.phone": "Tel√©fono",
                "contact.email": "Email",
                "contact.hours.title": "Horario",
                "contact.hours.monday": "Lunes-Martes: 10h-13h y 16h-19h",
                "contact.hours.wednesday": "Mi√©rcoles-Viernes: 10h-15h",
                
                "footer.rights": "Todos los derechos reservados.",
                "footer.privacy": "Su privacidad es importante para nosotros"
            },
            fr: {
                "nav.logo": "Lunagestio",
                "nav.home": "Accueil",
                "nav.services": "Services",
                "nav.contact": "Contact",
                "nav.appointment": "Rendez-vous",
                
                "auth.login": "Connexion",
                "auth.register": "Inscription",
                "auth.logout": "D√©connexion",
                "auth.sync": "Synchroniser",
                "auth.welcome": "Bonjour",
                "auth.notifications": "Notifications",
                "auth.adminMode": "Mode Administrateur",
                "auth.adminMessage": "Vous √™tes connect√© en tant qu'administrateur. Pour prendre un rendez-vous, utilisez un compte client.",
                "auth.changeAccount": "Changer de compte",
                "auth.connected": "Connect√©",
                "auth.canBook": "Vous pouvez maintenant prendre un rendez-vous.",
                "auth.loginRequired": "Connexion Requise",
                "auth.loginMessage": "Vous devez √™tre connect√© pour prendre un rendez-vous.",
                
                "login.title": "Connexion",
                "login.email": "Email",
                "login.emailPlaceholder": "Entrez votre email",
                "login.password": "Mot de passe",
                "login.passwordPlaceholder": "Entrez votre mot de passe",
                "login.button": "Connexion",
                "login.noAccount": "Vous n'avez pas de compte?",
                "login.register": "Inscrivez-vous ici",
                
                "register.title": "Cr√©er un Compte",
                "register.firstName": "Pr√©nom",
                "register.firstNamePlaceholder": "Entrez votre pr√©nom",
                "register.lastName": "Nom",
                "register.lastNamePlaceholder": "Entrez votre nom",
                "register.email": "Email",
                "register.emailPlaceholder": "Entrez votre email",
                "register.password": "Mot de passe",
                "register.passwordPlaceholder": "Cr√©ez un mot de passe",
                "register.button": "Cr√©er un Compte",
                "register.haveAccount": "Vous avez d√©j√† un compte?",
                "register.login": "Connectez-vous ici",
                
                "messages.title": "Messages Re√ßus",
                "messages.noMessages": "Vous n'avez aucun nouveau message",
                "messages.from": "De",
                "messages.date": "Date",
                "messages.type": "Type",
                "messages.confirmation": "Confirmation",
                "messages.cancellation": "Annulation",
                "messages.information": "Information",
                "messages.reminder": "Rappel",
                "messages.other": "Autres",
                "messages.unread": "Non lu",
                
                "hero.title": "Lunagestio - Votre Partenaire de Confiance",
                "hero.subtitle": "Services complets de gestion : √âtrang√©rie, Fiscalit√©, Comptabilit√© et plus",
                "hero.cta": "Prendre Rendez-vous",
                
                "services.title": "Nos Services",
                "services.foreign.title": "√âtrang√©rie",
                "services.foreign.description": "Gestion compl√®te des d√©marches d'√©trang√©rie pour les r√©sidents internationaux.",
                "services.foreign.feature1": "Permis de r√©sidence et travail",
                "services.foreign.feature2": "Nationalit√© espagnole",
                "services.foreign.feature3": "Regroupement familial",
                "services.foreign.feature4": "Traductions asserment√©es",
                "services.foreign.feature5": "Conseil juridique migratoire",
                
                "services.labor.title": "Fiscal / Comptable",
                "services.labor.description": "Solutions int√©grales pour entreprises et ind√©pendants.",
                "services.labor.feature1": "Gestion des paies et contrats",
                "services.labor.feature2": "Inscriptions S√©curit√© Sociale",
                "services.labor.feature3": "D√©clarations d'imp√¥ts",
                "services.labor.feature4": "Conseil fiscal",
                "services.labor.feature5": "Comptabilit√© pour entreprises",
                
                "services.insurance.title": "Assurances",
                "services.insurance.description": "Trouvez les meilleures couvertures d'assurance.",
                "services.insurance.feature1": "Assurances habitation",
                "services.insurance.feature2": "Assurances sant√© et vie",
                "services.insurance.feature3": "Assurances automobile",
                "services.insurance.feature4": "Responsabilit√© civile",
                "services.insurance.feature5": "Comparaison de compagnies",
                
                "services.vehicles.title": "V√©hicules",
                "services.vehicles.description": "Gestion de toutes les d√©marches li√©es √† votre v√©hicule.",
                "services.vehicles.feature1": "Transferts de v√©hicules",
                "services.vehicles.feature2": "Immatriculations et CT",
                "services.vehicles.feature3": "Permis de circulation",
                "services.vehicles.feature4": "Radiation temporaire/d√©finitive",
                "services.vehicles.feature5": "Gestion des amendes",
                
                "appointment.title": "Prendre un Rendez-vous",
                "appointment.subtitle": "R√©servez votre consultation en ligne",
                
                "availability.title": "Horaires Disponibles",
                "availability.schedule": "Lundi-Mardi: 10h-13h et 16h-19h | Mercredi-Vendredi: 10h-15h",
                "availability.closed": "Ferm√©: week-ends et jours f√©ri√©s",
                
                "form.service": "Service demand√© *",
                "form.selectService": "S√©lectionnez un service",
                "form.selectDate": "Date souhait√©e *",
                "form.selectTime": "Heure *",
                "form.message": "Message (optionnel)",
                "form.messagePlaceholder": "Informations suppl√©mentaires sur votre consultation...",
                "form.other": "Autres",
                "form.submit": "Confirmer le Rendez-vous",
                
                "myAppointments.title": "Mes Rendez-vous",
                "myAppointments.subtitle": "G√©rez vos rendez-vous programm√©s",
                "myAppointments.total": "Total",
                "myAppointments.confirmed": "Confirm√©s",
                "myAppointments.pending": "En attente",
                "myAppointments.cancelled": "Annul√©s",
                "myAppointments.noAppointments": "Vous n'avez aucun rendez-vous programm√©",
                "myAppointments.service": "Service",
                "myAppointments.date": "Date",
                "myAppointments.time": "Heure",
                "myAppointments.status": "Statut",
                "myAppointments.cancel": "Annuler",
                "myAppointments.reschedule": "Reprogrammer",
                
                "query.title": "Consulter vos Rendez-vous",
                "query.subtitle": "V√©rifiez l'√©tat de vos rendez-vous programm√©s",
                "query.email": "Email *",
                "query.emailPlaceholder": "Entrez l'email utilis√© pour la r√©servation",
                "query.button": "Consulter les Rendez-vous",
                
                "contact.title": "Contact",
                "contact.address": "Adresse",
                "contact.phone": "T√©l√©phone",
                "contact.email": "Email",
                "contact.hours.title": "Horaires",
                "contact.hours.monday": "Lundi-Mardi: 10h-13h et 16h-19h",
                "contact.hours.wednesday": "Mercredi-Vendredi: 10h-15h",
                
                "footer.rights": "Tous droits r√©serv√©s.",
                "footer.privacy": "Votre vie priv√©e est importante pour nous"
            },
            en: {
                "nav.logo": "Lunagestio",
                "nav.home": "Home",
                "nav.services": "Services",
                "nav.contact": "Contact",
                "nav.appointment": "Appointments",
                
                "auth.login": "Login",
                "auth.register": "Register",
                "auth.logout": "Logout",
                "auth.sync": "Sync",
                "auth.welcome": "Hello",
                "auth.notifications": "Notifications",
                "auth.adminMode": "Admin Mode",
                "auth.adminMessage": "You are logged in as administrator. To book an appointment, use a client account.",
                "auth.changeAccount": "Change account",
                "auth.connected": "Connected",
                "auth.canBook": "You can now book an appointment.",
                "auth.loginRequired": "Login Required",
                "auth.loginMessage": "You must be logged in to book an appointment.",
                
                "login.title": "Login",
                "login.email": "Email",
                "login.emailPlaceholder": "Enter your email",
                "login.password": "Password",
                "login.passwordPlaceholder": "Enter your password",
                "login.button": "Login",
                "login.noAccount": "Don't have an account?",
                "login.register": "Register here",
                
                "register.title": "Create Account",
                "register.firstName": "First Name",
                "register.firstNamePlaceholder": "Enter your first name",
                "register.lastName": "Last Name",
                "register.lastNamePlaceholder": "Enter your last name",
                "register.email": "Email",
                "register.emailPlaceholder": "Enter your email",
                "register.password": "Password",
                "register.passwordPlaceholder": "Create a password",
                "register.button": "Create Account",
                "register.haveAccount": "Already have an account?",
                "register.login": "Login here",
                
                "messages.title": "Received Messages",
                "messages.noMessages": "You have no new messages",
                "messages.from": "From",
                "messages.date": "Date",
                "messages.type": "Type",
                "messages.confirmation": "Confirmation",
                "messages.cancellation": "Cancellation",
                "messages.information": "Information",
                "messages.reminder": "Reminder",
                "messages.other": "Other",
                "messages.unread": "Unread",
                
                "hero.title": "Lunagestio - Your Trusted Partner",
                "hero.subtitle": "Comprehensive management services: Foreign Affairs, Taxation, Accounting and more",
                "hero.cta": "Request Appointment",
                
                "services.title": "Our Services",
                "services.foreign.title": "Foreign Affairs",
                "services.foreign.description": "Complete management of foreign procedures for international residents.",
                "services.foreign.feature1": "Residence and work permits",
                "services.foreign.feature2": "Spanish nationality",
                "services.foreign.feature3": "Family reunification",
                "services.foreign.feature4": "Sworn translations",
                "services.foreign.feature5": "Legal migration advice",
                
                "services.labor.title": "Tax / Accounting",
                "services.labor.description": "Comprehensive solutions for companies and self-employed.",
                "services.labor.feature1": "Payroll and contract management",
                "services.labor.feature2": "Social Security registrations",
                "services.labor.feature3": "Tax declarations",
                "services.labor.feature4": "Tax advice",
                "services.labor.feature5": "Business accounting",
                
                "services.insurance.title": "Insurance",
                "services.insurance.description": "Find the best insurance coverage.",
                "services.insurance.feature1": "Home insurance",
                "services.insurance.feature2": "Health and life insurance",
                "services.insurance.feature3": "Car insurance",
                "services.insurance.feature4": "Civil liability",
                "services.insurance.feature5": "Company comparison",
                
                "services.vehicles.title": "Vehicles",
                "services.vehicles.description": "Management of all procedures related to your vehicle.",
                "services.vehicles.feature1": "Vehicle transfers",
                "services.vehicles.feature2": "Registration and MOT",
                "services.vehicles.feature3": "Driving permits",
                "services.vehicles.feature4": "Temporary/permanent deregistration",
                "services.vehicles.feature5": "Fine management",
                
                "appointment.title": "Request an Appointment",
                "appointment.subtitle": "Book your consultation online",
                
                "availability.title": "Available Hours",
                "availability.schedule": "Monday-Tuesday: 10am-1pm and 4pm-7pm | Wednesday-Friday: 10am-3pm",
                "availability.closed": "Closed: weekends and holidays",
                
                "form.service": "Requested Service *",
                "form.selectService": "Select a service",
                "form.selectDate": "Desired Date *",
                "form.selectTime": "Time *",
                "form.message": "Message (optional)",
                "form.messagePlaceholder": "Additional information about your consultation...",
                "form.other": "Other",
                "form.submit": "Confirm Appointment",
                
                "myAppointments.title": "My Appointments",
                "myAppointments.subtitle": "Manage your scheduled appointments",
                "myAppointments.total": "Total",
                "myAppointments.confirmed": "Confirmed",
                "myAppointments.pending": "Pending",
                "myAppointments.cancelled": "Cancelled",
                "myAppointments.noAppointments": "You have no scheduled appointments",
                "myAppointments.service": "Service",
                "myAppointments.date": "Date",
                "myAppointments.time": "Time",
                "myAppointments.status": "Status",
                "myAppointments.cancel": "Cancel",
                "myAppointments.reschedule": "Reschedule",
                
                "query.title": "Check Your Appointments",
                "query.subtitle": "Verify the status of your scheduled appointments",
                "query.email": "Email *",
                "query.emailPlaceholder": "Enter the email used for booking",
                "query.button": "Check Appointments",
                
                "contact.title": "Contact",
                "contact.address": "Address",
                "contact.phone": "Phone",
                "contact.email": "Email",
                "contact.hours.title": "Hours",
                "contact.hours.monday": "Monday-Tuesday: 10am-1pm and 4pm-7pm",
                "contact.hours.wednesday": "Wednesday-Friday: 10am-3pm",
                
                "footer.rights": "All rights reserved.",
                "footer.privacy": "Your privacy is important to us"
            }
        };

        // ===== GESTIONADOR FIREBASE =====
        const FirebaseManager = {
            // Guardar una cita
            saveAppointment: async function(appointment) {
                try {
                    const { collection, addDoc, serverTimestamp } = await import('https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js');
                    
                    const docRef = await addDoc(collection(window.db, 'appointments'), {
                        ...appointment,
                        createdAt: serverTimestamp(),
                        updatedAt: serverTimestamp()
                    });
                    
                    console.log('‚úÖ Cita guardada correctamente con ID:', docRef.id);
                    return { ...appointment, id: docRef.id };
                } catch (error) {
                    console.error('‚ùå Error guardando en Firebase:', error);
                    throw error;
                }
            },

            // Obtener citas por email
            getAppointmentsByEmail: async function(email) {
                try {
                    const { collection, query, where, orderBy, getDocs } = await import('https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js');
                    
                    const q = query(
                        collection(window.db, 'appointments'),
                        where('userEmail', '==', email.toLowerCase()),
                        orderBy('date'),
                        orderBy('time')
                    );
                    
                    const snapshot = await getDocs(q);
                    const appointments = [];
                    snapshot.forEach(doc => {
                        appointments.push({
                            id: doc.id,
                            ...doc.data()
                        });
                    });
                    
                    console.log('üì• Citas recuperadas:', appointments.length);
                    return appointments;
                } catch (error) {
                    console.error('‚ùå Error recuperando de Firebase:', error);
                    throw error;
                }
            },

            // Obtener mensajes del usuario
            getUserMessages: async function(userId) {
                try {
                    const { collection, query, where, orderBy, getDocs } = await import('https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js');
                    
                    const q = query(
                        collection(window.db, 'messages'),
                        where('userId', '==', userId),
                        orderBy('createdAt', 'desc')
                    );
                    
                    const snapshot = await getDocs(q);
                    const messages = [];
                    snapshot.forEach(doc => {
                        messages.push({
                            id: doc.id,
                            ...doc.data()
                        });
                    });
                    
                    console.log('üì® Mensajes recuperados:', messages.length);
                    return messages;
                } catch (error) {
                    console.error('‚ùå Error recuperando mensajes:', error);
                    return [];
                }
            },

            // Marcar mensaje como le√≠do
            markMessageAsRead: async function(messageId) {
                try {
                    const { doc, updateDoc, serverTimestamp } = await import('https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js');
                    await updateDoc(doc(window.db, 'messages', messageId), {
                        read: true,
                        readAt: serverTimestamp()
                    });
                    return true;
                } catch (error) {
                    console.error('‚ùå Error marcando mensaje como le√≠do:', error);
                    return false;
                }
            },

            // Obtener todos los usuarios (para simulaci√≥n)
            getUsers: async function() {
                try {
                    const { collection, getDocs } = await import('https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js');
                    
                    const snapshot = await getDocs(collection(window.db, 'users'));
                    const users = [];
                    snapshot.forEach(doc => {
                        users.push({
                            id: doc.id,
                            ...doc.data()
                        });
                    });
                    
                    return users;
                } catch (error) {
                    console.error('‚ùå Error recuperando usuarios:', error);
                    return [];
                }
            },

            // Crear un nuevo usuario
            createUser: async function(userData) {
                try {
                    const { collection, addDoc, serverTimestamp } = await import('https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js');
                    
                    const docRef = await addDoc(collection(window.db, 'users'), {
                        ...userData,
                        createdAt: serverTimestamp(),
                        updatedAt: serverTimestamp()
                    });
                    
                    console.log('‚úÖ Usuario creado correctamente con ID:', docRef.id);
                    return { ...userData, id: docRef.id };
                } catch (error) {
                    console.error('‚ùå Error creando usuario:', error);
                    throw error;
                }
            }
        };

        // ===== GESTIONADOR DE USUARIOS =====
        const UserManager = {
            getCurrentUser: () => {
                return JSON.parse(localStorage.getItem('lunagestio_current_user'));
            },

            setCurrentUser: (user) => {
                localStorage.setItem('lunagestio_current_user', JSON.stringify(user));
            },

            logout: () => {
                localStorage.removeItem('lunagestio_current_user');
            },

            // Simulaci√≥n de login (en un sistema real, esto se har√≠a con autenticaci√≥n Firebase)
            login: async function(email, password) {
                try {
                    const users = await FirebaseManager.getUsers();
                    const user = users.find(u => u.email === email && u.password === password);
                    
                    if (user) {
                        this.setCurrentUser(user);
                        return { success: true, user };
                    } else {
                        return { success: false, error: "Email o contrase√±a incorrectos" };
                    }
                } catch (error) {
                    return { success: false, error: "Error de conexi√≥n. Intente nuevamente." };
                }
            },

            // Simulaci√≥n de registro
            register: async function(userData) {
                try {
                    const users = await FirebaseManager.getUsers();
                    const existingUser = users.find(u => u.email === userData.email);
                    
                    if (existingUser) {
                        return { success: false, error: "Ya existe un usuario con este email" };
                    }
                    
                    const newUser = await FirebaseManager.createUser(userData);
                    this.setCurrentUser(newUser);
                    return { success: true, user: newUser };
                } catch (error) {
                    return { success: false, error: "Error al crear la cuenta. Intente nuevamente." };
                }
            }
        };

        // ===== VARIABLES GLOBALES =====
        let currentLang = 'ca';
        let unreadMessagesCount = 0;
        let messagesCheckInterval = null;

        // ===== SISTEMA DE NOTIFICATIONS =====

        // Charger les messages de l'utilisateur
        async function loadUserMessages() {
            const currentUser = UserManager.getCurrentUser();
            if (!currentUser) return;

            try {
                const messages = await FirebaseManager.getUserMessages(currentUser.id);
                updateUnreadMessagesCount(messages);
                return messages;
            } catch (error) {
                console.error('Error cargando mensajes:', error);
                return [];
            }
        }

        // Mettre √† jour le compteur de messages non lus
        function updateUnreadMessagesCount(messages) {
            unreadMessagesCount = messages.filter(msg => !msg.read).length;
            updateNotificationBadge();
        }

        // Mettre √† jour le badge de notification
        function updateNotificationBadge() {
            const notificationBtn = document.getElementById('notificationBtn');
            if (notificationBtn) {
                const badge = notificationBtn.querySelector('.notification-badge');
                if (unreadMessagesCount > 0) {
                    if (!badge) {
                        const newBadge = document.createElement('span');
                        newBadge.className = 'notification-badge';
                        newBadge.textContent = unreadMessagesCount > 9 ? '9+' : unreadMessagesCount;
                        notificationBtn.appendChild(newBadge);
                    } else {
                        badge.textContent = unreadMessagesCount > 9 ? '9+' : unreadMessagesCount;
                    }
                } else if (badge) {
                    badge.remove();
                }
            }
        }

        // Ouvrir le modal des messages
        async function openMessagesModal() {
            const messages = await loadUserMessages();
            displayMessages(messages);
            document.getElementById('messagesModal').style.display = 'block';
        }

        // Fermer le modal des messages
        function closeMessagesModal() {
            document.getElementById('messagesModal').style.display = 'none';
        }

        // Afficher les messages dans le modal
        function displayMessages(messages) {
            const messagesList = document.getElementById('messagesList');
            
            if (messages.length === 0) {
                messagesList.innerHTML = `
                    <div class="no-messages">
                        <i class="fas fa-envelope-open"></i>
                        <h3 data-i18n="messages.noMessages">No teniu cap missatge nou</h3>
                        <p>${translations[currentLang]?.["messages.noMessages"] || 'You have no new messages'}</p>
                    </div>
                `;
                return;
            }

            messagesList.innerHTML = messages.map(message => {
                const messageDate = message.createdAt?.toDate ? message.createdAt.toDate() : new Date(message.createdAt);
                const isUnread = !message.read;
                
                return `
                    <div class="message-item ${isUnread ? 'unread' : ''}" onclick="openMessage('${message.id}')">
                        <div class="message-header">
                            <div>
                                <div class="message-sender">${translations[currentLang]?.["messages.from"] || 'From'}: Lunagestio</div>
                                <div class="message-date">${formatDateTime(messageDate)}</div>
                            </div>
                            <span class="message-type ${message.type}">
                                ${getMessageTypeText(message.type)}
                            </span>
                        </div>
                        <div class="message-subject">${message.subject}</div>
                        <div class="message-content">${message.content}</div>
                        ${isUnread ? `
                            <div style="color: #e74c3c; font-weight: bold; font-size: 0.9rem;">
                                <i class="fas fa-circle"></i> ${translations[currentLang]?.["messages.unread"] || 'Unread'}
                            </div>
                        ` : ''}
                    </div>
                `;
            }).join('');
            
            changeLanguage(currentLang);
        }

        // Ouvrir un message sp√©cifique
        async function openMessage(messageId) {
            // Marquer comme lu
            await FirebaseManager.markMessageAsRead(messageId);
            
            // Recharger les messages
            const messages = await loadUserMessages();
            displayMessages(messages);
        }

        // Obtenir le texte du type de message
        function getMessageTypeText(type) {
            const types = {
                'confirmation': translations[currentLang]?.["messages.confirmation"] || 'Confirmation',
                'cancellation': translations[currentLang]?.["messages.cancellation"] || 'Cancellation',
                'information': translations[currentLang]?.["messages.information"] || 'Information',
                'reminder': translations[currentLang]?.["messages.reminder"] || 'Reminder',
                'other': translations[currentLang]?.["messages.other"] || 'Other'
            };
            return types[type] || type;
        }

        // Format de date et heure
        function formatDateTime(date) {
            const options = {
                year: 'numeric',
                month: 'short',
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            };
            
            const locales = {
                'ca': 'ca-ES',
                'es': 'es-ES',
                'fr': 'fr-FR',
                'en': 'en-US'
            };
            
            return date.toLocaleString(locales[currentLang] || 'ca-ES', options);
        }

        // ===== GESTI√ìN DE AUTENTICACI√ìN =====
        function updateAuthButtons() {
            const container = document.getElementById('authButtonsContainer');
            const currentUser = UserManager.getCurrentUser();
            
            if (currentUser) {
                const welcomeText = translations[currentLang]?.["auth.welcome"] || 'Hello';
                const syncText = translations[currentLang]?.["auth.sync"] || 'Sync';
                const logoutText = translations[currentLang]?.["auth.logout"] || 'Logout';
                const notificationsText = translations[currentLang]?.["auth.notifications"] || 'Notifications';
                
                container.innerHTML = `
                    <span class="user-welcome">
                        <i class="fas fa-user-circle"></i>
                        ${welcomeText} ${currentUser.firstName}
                    </span>
                    <button onclick="syncData()" class="btn-auth btn-sync" title="${syncText}">
                        <i class="fas fa-sync-alt"></i>
                    </button>
                    <button onclick="openMessagesModal()" class="btn-auth btn-notification" title="${notificationsText}" id="notificationBtn">
                        <i class="fas fa-bell"></i>
                        ${unreadMessagesCount > 0 ? `<span class="notification-badge">${unreadMessagesCount > 9 ? '9+' : unreadMessagesCount}</span>` : ''}
                    </button>
                    <button onclick="logout()" class="btn-auth btn-logout">
                        <i class="fas fa-sign-out-alt"></i> ${logoutText}
                    </button>
                `;
            } else {
                container.innerHTML = `
                    <button onclick="showLogin()" class="btn-auth btn-login">
                        <i class="fas fa-sign-in-alt"></i> <span data-i18n="auth.login">Iniciar sessi√≥</span>
                    </button>
                    <button onclick="showRegister()" class="btn-auth btn-register">
                        <i class="fas fa-user-plus"></i> <span data-i18n="auth.register">Registre</span>
                    </button>
                `;
            }
            
            changeLanguage(currentLang);
        }

        // V√©rification p√©riodique des nouveaux messages
        function startMessagesPolling() {
            if (messagesCheckInterval) {
                clearInterval(messagesCheckInterval);
            }
            
            messagesCheckInterval = setInterval(async () => {
                const currentUser = UserManager.getCurrentUser();
                if (currentUser) {
                    await loadUserMessages();
                }
            }, 30000); // V√©rifier toutes les 30 secondes
        }

        // Arr√™ter la v√©rification des messages
        function stopMessagesPolling() {
            if (messagesCheckInterval) {
                clearInterval(messagesCheckInterval);
                messagesCheckInterval = null;
            }
        }

        // ===== GESTI√ìN DE CONEXI√ìN =====
        function showLogin() {
            document.getElementById('login').style.display = 'block';
            document.getElementById('register').style.display = 'none';
            document.getElementById('my-appointments').style.display = 'none';
            scrollToSection('login');
        }

        function showRegister() {
            document.getElementById('login').style.display = 'none';
            document.getElementById('register').style.display = 'block';
            document.getElementById('my-appointments').style.display = 'none';
            scrollToSection('login');
        }

        function showMyAppointments() {
            document.getElementById('login').style.display = 'none';
            document.getElementById('register').style.display = 'none';
            document.getElementById('my-appointments').style.display = 'block';
            loadUserAppointments();
            scrollToSection('my-appointments');
        }

        async function login() {
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;
            const loginBtn = document.getElementById('loginBtn');
            
            if (!email || !password) {
                showMessage(
                    currentLang === 'ca' ? 'Si us plau, ompliu tots els camps' :
                    currentLang === 'es' ? 'Por favor, complete todos los campos' :
                    currentLang === 'fr' ? 'Veuillez remplir tous les champs' :
                    'Please fill in all fields',
                    'error'
                );
                return;
            }
            
            loginBtn.disabled = true;
            loginBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> ' + (translations[currentLang]?.["login.button"] || 'Login');
            
            const result = await UserManager.login(email, password);
            
            if (result.success) {
                showMessage(
                    currentLang === 'ca' ? 'Sessi√≥ iniciada correctament' :
                    currentLang === 'es' ? 'Sesi√≥n iniciada correctamente' :
                    currentLang === 'fr' ? 'Connexion r√©ussie' :
                    'Login successful',
                    'success'
                );
                
                updateAuthButtons();
                checkAppointmentAuth();
                await loadUserMessages();
                startMessagesPolling();
                showMyAppointments();
            } else {
                showMessage(result.error, 'error');
            }
            
            loginBtn.disabled = false;
            loginBtn.innerHTML = '<i class="fas fa-sign-in-alt"></i> ' + (translations[currentLang]?.["login.button"] || 'Login');
        }

        async function register() {
            const firstName = document.getElementById('registerFirstName').value;
            const lastName = document.getElementById('registerLastName').value;
            const email = document.getElementById('registerEmail').value;
            const password = document.getElementById('registerPassword').value;
            const registerBtn = document.getElementById('registerBtn');
            
            if (!firstName || !lastName || !email || !password) {
                showMessage(
                    currentLang === 'ca' ? 'Si us plau, ompliu tots els camps' :
                    currentLang === 'es' ? 'Por favor, complete todos los campos' :
                    currentLang === 'fr' ? 'Veuillez remplir tous les champs' :
                    'Please fill in all fields',
                    'error'
                );
                return;
            }
            
            registerBtn.disabled = true;
            registerBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> ' + (translations[currentLang]?.["register.button"] || 'Register');
            
            const userData = {
                firstName,
                lastName,
                email,
                password,
                role: 'client'
            };
            
            const result = await UserManager.register(userData);
            
            if (result.success) {
                showMessage(
                    currentLang === 'ca' ? 'Compte creat correctament' :
                    currentLang === 'es' ? 'Cuenta creada correctamente' :
                    currentLang === 'fr' ? 'Compte cr√©√© avec succ√®s' :
                    'Account created successfully',
                    'success'
                );
                
                updateAuthButtons();
                checkAppointmentAuth();
                await loadUserMessages();
                startMessagesPolling();
                showMyAppointments();
            } else {
                showMessage(result.error, 'error');
            }
            
            registerBtn.disabled = false;
            registerBtn.innerHTML = '<i class="fas fa-user-plus"></i> ' + (translations[currentLang]?.["register.button"] || 'Register');
        }

        async function logout() {
            const confirmMessage = 
                currentLang === 'ca' ? 'Esteu segur que voleu tancar la sessi√≥?' :
                currentLang === 'es' ? '¬øEst√°s seguro de que quieres cerrar sesi√≥n?' :
                currentLang === 'fr' ? '√ätes-vous s√ªr de vouloir vous d√©connecter ?' :
                'Are you sure you want to log out?';
            
            if (confirm(confirmMessage)) {
                stopMessagesPolling();
                
                // Sincronizar antes de desconectar
                if (window.SyncManager) {
                    await window.SyncManager.quickSync();
                }
                
                UserManager.logout();
                updateAuthButtons();
                checkAppointmentAuth();
                
                // Ocultar secci√≥n de mis citas
                document.getElementById('my-appointments').style.display = 'none';
                
                showMessage(
                    currentLang === 'ca' ? 'Sessi√≥ tancada correctament' :
                    currentLang === 'es' ? 'Sesi√≥n cerrada correctamente' :
                    currentLang === 'fr' ? 'D√©connexion r√©ussie' :
                    'Logout successful', 
                    'success'
                );
            }
        }

        // ===== GESTI√ìN DE CITAS =====
        function checkAppointmentAuth() {
            const authCheck = document.getElementById('appointmentAuthCheck');
            const appointmentForm = document.getElementById('appointmentForm');
            const currentUser = UserManager.getCurrentUser();
            
            if (currentUser) {
                authCheck.innerHTML = `
                    <div class="success-message">
                        <i class="fas fa-check-circle"></i> 
                        ${translations[currentLang]?.["auth.connected"] || 'Connected'}: ${currentUser.firstName} ${currentUser.lastName}
                        <br>
                        ${translations[currentLang]?.["auth.canBook"] || 'You can now book an appointment.'}
                    </div>
                `;
                appointmentForm.style.display = 'block';
            } else {
                authCheck.innerHTML = `
                    <div class="error-message">
                        <i class="fas fa-exclamation-circle"></i> 
                        ${translations[currentLang]?.["auth.loginRequired"] || 'Login Required'}
                        <br>
                        ${translations[currentLang]?.["auth.loginMessage"] || 'You must be logged in to book an appointment.'}
                        <br><br>
                        <button onclick="showLogin()" class="btn btn-login" style="padding: 0.5rem 1rem;">
                            <i class="fas fa-sign-in-alt"></i> ${translations[currentLang]?.["auth.login"] || 'Login'}
                        </button>
                    </div>
                `;
                appointmentForm.style.display = 'none';
            }
            
            changeLanguage(currentLang);
        }

        async function loadUserAppointments() {
            const currentUser = UserManager.getCurrentUser();
            if (!currentUser) return;
            
            try {
                const appointments = await FirebaseManager.getAppointmentsByEmail(currentUser.email);
                displayUserAppointments(appointments);
            } catch (error) {
                console.error('Error cargando citas:', error);
                showMessage(
                    currentLang === 'ca' ? 'Error carregant les cites' :
                    currentLang === 'es' ? 'Error cargando las citas' :
                    currentLang === 'fr' ? 'Erreur de chargement des rendez-vous' :
                    'Error loading appointments',
                    'error'
                );
            }
        }

        function displayUserAppointments(appointments) {
            const appointmentsList = document.getElementById('appointmentsList');
            const appointmentsStats = document.getElementById('appointmentsStats');
            
            if (appointments.length === 0) {
                appointmentsList.innerHTML = `
                    <div class="no-messages">
                        <i class="fas fa-calendar-times"></i>
                        <h3>${translations[currentLang]?.["myAppointments.noAppointments"] || 'You have no scheduled appointments'}</h3>
                    </div>
                `;
                
                appointmentsStats.innerHTML = '';
                return;
            }
            
            // Calcular estad√≠sticas
            const total = appointments.length;
            const confirmed = appointments.filter(a => a.status === 'confirmed').length;
            const pending = appointments.filter(a => a.status === 'pending').length;
            const cancelled = appointments.filter(a => a.status === 'cancelled').length;
            
            // Mostrar estad√≠sticas
            appointmentsStats.innerHTML = `
                <div class="stat-card">
                    <div class="stat-number">${total}</div>
                    <div class="stat-label">${translations[currentLang]?.["myAppointments.total"] || 'Total'}</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" style="color: #27ae60;">${confirmed}</div>
                    <div class="stat-label">${translations[currentLang]?.["myAppointments.confirmed"] || 'Confirmed'}</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" style="color: #f39c12;">${pending}</div>
                    <div class="stat-label">${translations[currentLang]?.["myAppointments.pending"] || 'Pending'}</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" style="color: #e74c3c;">${cancelled}</div>
                    <div class="stat-label">${translations[currentLang]?.["myAppointments.cancelled"] || 'Cancelled'}</div>
                </div>
            `;
            
            // Mostrar lista de citas
            appointmentsList.innerHTML = appointments.map(appointment => {
                const appointmentDate = new Date(appointment.date);
                const formattedDate = appointmentDate.toLocaleDateString(
                    currentLang === 'ca' ? 'ca-ES' : 
                    currentLang === 'es' ? 'es-ES' : 
                    currentLang === 'fr' ? 'fr-FR' : 'en-US',
                    { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' }
                );
                
                const statusClass = {
                    'confirmed': 'status-confirmed',
                    'pending': 'status-pending',
                    'cancelled': 'status-cancelled'
                }[appointment.status] || 'status-pending';
                
                const statusText = {
                    'confirmed': translations[currentLang]?.["myAppointments.confirmed"] || 'Confirmed',
                    'pending': translations[currentLang]?.["myAppointments.pending"] || 'Pending',
                    'cancelled': translations[currentLang]?.["myAppointments.cancelled"] || 'Cancelled'
                }[appointment.status] || appointment.status;
                
                const serviceText = {
                    'extranjeria': translations[currentLang]?.["services.foreign.title"] || 'Foreign Affairs',
                    'laboral': translations[currentLang]?.["services.labor.title"] || 'Tax / Accounting',
                    'seguros': translations[currentLang]?.["services.insurance.title"] || 'Insurance',
                    'vehiculos': translations[currentLang]?.["services.vehicles.title"] || 'Vehicles',
                    'otro': translations[currentLang]?.["form.other"] || 'Other'
                }[appointment.service] || appointment.service;
                
                return `
                    <div class="appointment-card ${appointment.status}">
                        <div class="appointment-header">
                            <div class="appointment-service">${serviceText}</div>
                            <span class="appointment-status ${statusClass}">${statusText}</span>
                        </div>
                        <div class="appointment-details">
                            <div><strong>${translations[currentLang]?.["myAppointments.date"] || 'Date'}:</strong> ${formattedDate}</div>
                            <div><strong>${translations[currentLang]?.["myAppointments.time"] || 'Time'}:</strong> ${appointment.time}</div>
                            ${appointment.message ? `<div><strong>${translations[currentLang]?.["form.message"] || 'Message'}:</strong> ${appointment.message}</div>` : ''}
                        </div>
                        ${appointment.status !== 'cancelled' ? `
                            <div class="appointment-actions">
                                <button class="btn-action btn-cancel" onclick="cancelAppointment('${appointment.id}')">
                                    ${translations[currentLang]?.["myAppointments.cancel"] || 'Cancel'}
                                </button>
                                <button class="btn-action btn-reschedule" onclick="rescheduleAppointment('${appointment.id}')">
                                    ${translations[currentLang]?.["myAppointments.reschedule"] || 'Reschedule'}
                                </button>
                            </div>
                        ` : ''}
                    </div>
                `;
            }).join('');
            
            changeLanguage(currentLang);
        }

        async function cancelAppointment(appointmentId) {
            const confirmMessage = 
                currentLang === 'ca' ? 'Esteu segur que voleu cancel¬∑lar aquesta cita?' :
                currentLang === 'es' ? '¬øEst√° seguro de que quiere cancelar esta cita?' :
                currentLang === 'fr' ? '√ätes-vous s√ªr de vouloir annuler ce rendez-vous?' :
                'Are you sure you want to cancel this appointment?';
            
            if (confirm(confirmMessage)) {
                try {
                    const { doc, updateDoc, serverTimestamp } = await import('https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js');
                    await updateDoc(doc(window.db, 'appointments', appointmentId), {
                        status: 'cancelled',
                        updatedAt: serverTimestamp()
                    });
                    
                    showMessage(
                        currentLang === 'ca' ? 'Cita cancel¬∑lada correctament' :
                        currentLang === 'es' ? 'Cita cancelada correctamente' :
                        currentLang === 'fr' ? 'Rendez-vous annul√© avec succ√®s' :
                        'Appointment cancelled successfully',
                        'success'
                    );
                    
                    // Recargar citas
                    await loadUserAppointments();
                } catch (error) {
                    console.error('Error cancelando cita:', error);
                    showMessage(
                        currentLang === 'ca' ? 'Error cancel¬∑lant la cita' :
                        currentLang === 'es' ? 'Error cancelando la cita' :
                        currentLang === 'fr' ? 'Erreur lors de l\'annulation du rendez-vous' :
                        'Error cancelling appointment',
                        'error'
                    );
                }
            }
        }

        function rescheduleAppointment(appointmentId) {
            showMessage(
                currentLang === 'ca' ? 'Funci√≥ de reprogramaci√≥ properament' :
                currentLang === 'es' ? 'Funci√≥n de reprogramaci√≥n pr√≥ximamente' :
                currentLang === 'fr' ? 'Fonction de reprogrammation bient√¥t disponible' :
                'Rescheduling function coming soon',
                'info'
            );
        }

        // ===== FUNCIONES EXISTENTES =====
        function changeLanguage(lang) {
            currentLang = lang;
            
            // Actualizar botones de idioma
            document.querySelectorAll('.lang-btn').forEach(btn => {
                if (btn.getAttribute('data-lang') === lang) {
                    btn.classList.add('active');
                } else {
                    btn.classList.remove('active');
                }
            });
            
            // Actualizar textos
            document.querySelectorAll('[data-i18n]').forEach(element => {
                const key = element.getAttribute('data-i18n');
                if (translations[lang] && translations[lang][key]) {
                    if (element.tagName === 'INPUT' || element.tagName === 'TEXTAREA') {
                        element.placeholder = translations[lang][key];
                    } else {
                        element.textContent = translations[lang][key];
                    }
                }
            });
        }

        function scrollToSection(sectionId) {
            document.getElementById(sectionId).scrollIntoView({ behavior: 'smooth' });
        }

        function showMessage(message, type) {
            // Crear elemento de mensaje
            const messageDiv = document.createElement('div');
            messageDiv.className = type === 'success' ? 'success-message' : 
                                  type === 'error' ? 'error-message' : 'availability-info';
            messageDiv.innerHTML = `
                <i class="fas ${type === 'success' ? 'fa-check-circle' : 
                              type === 'error' ? 'fa-exclamation-circle' : 'fa-info-circle'}"></i>
                ${message}
            `;
            
            // Insertar al principio del body
            document.body.insertBefore(messageDiv, document.body.firstChild);
            
            // Eliminar despu√©s de 5 segundos
            setTimeout(() => {
                if (messageDiv.parentNode) {
                    messageDiv.parentNode.removeChild(messageDiv);
                }
            }, 5000);
        }

        function configureTimeSlots() {
            const timeSelect = document.getElementById('appointmentTime');
            timeSelect.innerHTML = '<option value="" data-i18n="form.selectTime">Seleccioneu una hora</option>';
            
            // Horarios disponibles
            const timeSlots = [
                '10:00', '10:30', '11:00', '11:30', '12:00', '12:30',
                '16:00', '16:30', '17:00', '17:30', '18:00', '18:30'
            ];
            
            timeSlots.forEach(time => {
                const option = document.createElement('option');
                option.value = time;
                option.textContent = time;
                timeSelect.appendChild(option);
            });
            
            changeLanguage(currentLang);
        }

        async function queryAppointments() {
            const email = document.getElementById('queryEmail').value;
            const queryBtn = document.getElementById('queryBtn');
            const resultsDiv = document.getElementById('appointmentsResults');
            
            if (!email) {
                showMessage(
                    currentLang === 'ca' ? 'Si us plau, introdu√Øu un email' :
                    currentLang === 'es' ? 'Por favor, introduzca un email' :
                    currentLang === 'fr' ? 'Veuillez entrer un email' :
                    'Please enter an email',
                    'error'
                );
                return;
            }
            
            queryBtn.disabled = true;
            queryBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> ' + (translations[currentLang]?.["query.button"] || 'Check Appointments');
            
            try {
                const appointments = await FirebaseManager.getAppointmentsByEmail(email);
                
                if (appointments.length === 0) {
                    resultsDiv.innerHTML = `
                        <div class="no-messages">
                            <i class="fas fa-calendar-times"></i>
                            <h3>${translations[currentLang]?.["myAppointments.noAppointments"] || 'You have no scheduled appointments'}</h3>
                            <p>${translations[currentLang]?.["query.subtitle"] || 'Verify the status of your scheduled appointments'}</p>
                        </div>
                    `;
                } else {
                    // Mostrar estad√≠sticas
                    const total = appointments.length;
                    const confirmed = appointments.filter(a => a.status === 'confirmed').length;
                    const pending = appointments.filter(a => a.status === 'pending').length;
                    const cancelled = appointments.filter(a => a.status === 'cancelled').length;
                    
                    let statsHTML = `
                        <div class="appointments-stats">
                            <div class="stat-card">
                                <div class="stat-number">${total}</div>
                                <div class="stat-label">${translations[currentLang]?.["myAppointments.total"] || 'Total'}</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-number" style="color: #27ae60;">${confirmed}</div>
                                <div class="stat-label">${translations[currentLang]?.["myAppointments.confirmed"] || 'Confirmed'}</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-number" style="color: #f39c12;">${pending}</div>
                                <div class="stat-label">${translations[currentLang]?.["myAppointments.pending"] || 'Pending'}</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-number" style="color: #e74c3c;">${cancelled}</div>
                                <div class="stat-label">${translations[currentLang]?.["myAppointments.cancelled"] || 'Cancelled'}</div>
                            </div>
                        </div>
                    `;
                    
                    // Mostrar lista de citas
                    let appointmentsHTML = appointments.map(appointment => {
                        const appointmentDate = new Date(appointment.date);
                        const formattedDate = appointmentDate.toLocaleDateString(
                            currentLang === 'ca' ? 'ca-ES' : 
                            currentLang === 'es' ? 'es-ES' : 
                            currentLang === 'fr' ? 'fr-FR' : 'en-US',
                            { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' }
                        );
                        
                        const statusClass = {
                            'confirmed': 'status-confirmed',
                            'pending': 'status-pending',
                            'cancelled': 'status-cancelled'
                        }[appointment.status] || 'status-pending';
                        
                        const statusText = {
                            'confirmed': translations[currentLang]?.["myAppointments.confirmed"] || 'Confirmed',
                            'pending': translations[currentLang]?.["myAppointments.pending"] || 'Pending',
                            'cancelled': translations[currentLang]?.["myAppointments.cancelled"] || 'Cancelled'
                        }[appointment.status] || appointment.status;
                        
                        const serviceText = {
                            'extranjeria': translations[currentLang]?.["services.foreign.title"] || 'Foreign Affairs',
                            'laboral': translations[currentLang]?.["services.labor.title"] || 'Tax / Accounting',
                            'seguros': translations[currentLang]?.["services.insurance.title"] || 'Insurance',
                            'vehiculos': translations[currentLang]?.["services.vehicles.title"] || 'Vehicles',
                            'otro': translations[currentLang]?.["form.other"] || 'Other'
                        }[appointment.service] || appointment.service;
                        
                        return `
                            <div class="appointment-card ${appointment.status}">
                                <div class="appointment-header">
                                    <div class="appointment-service">${serviceText}</div>
                                    <span class="appointment-status ${statusClass}">${statusText}</span>
                                </div>
                                <div class="appointment-details">
                                    <div><strong>${translations[currentLang]?.["myAppointments.date"] || 'Date'}:</strong> ${formattedDate}</div>
                                    <div><strong>${translations[currentLang]?.["myAppointments.time"] || 'Time'}:</strong> ${appointment.time}</div>
                                    ${appointment.message ? `<div><strong>${translations[currentLang]?.["form.message"] || 'Message'}:</strong> ${appointment.message}</div>` : ''}
                                </div>
                            </div>
                        `;
                    }).join('');
                    
                    resultsDiv.innerHTML = statsHTML + appointmentsHTML;
                }
                
            } catch (error) {
                console.error('Error consultando citas:', error);
                resultsDiv.innerHTML = `
                    <div class="error-message">
                        <i class="fas fa-exclamation-circle"></i>
                        ${translations[currentLang]?.["query.error"] || 'Error loading appointments. Please try again.'}
                    </div>
                `;
            }
            
            queryBtn.disabled = false;
            queryBtn.innerHTML = '<i class="fas fa-search"></i> ' + (translations[currentLang]?.["query.button"] || 'Check Appointments');
        }

        // ===== INITIALISATION =====
        document.addEventListener('DOMContentLoaded', async function() {
            // Inicializar traducciones con catal√°n por defecto
            changeLanguage('ca');
            
            // A√±adir event listeners para los botones de idioma
            document.querySelectorAll('.lang-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    changeLanguage(this.getAttribute('data-lang'));
                });
            });

            // Actualizar botones de autenticaci√≥n
            updateAuthButtons();
            
            // Verificar autenticaci√≥n para citas
            checkAppointmentAuth();
            
            // Configurar fecha m√≠nima
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('appointmentDate').min = today;
            
            // Configurar horarios
            configureTimeSlots();
            
            // Configurar formulario de cita
            document.getElementById('appointmentForm').addEventListener('submit', async function(e) {
                e.preventDefault();
                
                const currentUser = UserManager.getCurrentUser();
                if (!currentUser) {
                    showMessage(
                        currentLang === 'ca' ? 'Heu d\'iniciar sessi√≥ per sol¬∑licitar una cita' :
                        currentLang === 'es' ? 'Debe iniciar sesi√≥n para solicitar una cita' :
                        currentLang === 'fr' ? 'Vous devez vous connecter pour prendre un rendez-vous' :
                        'You must be logged in to book an appointment',
                        'error'
                    );
                    return;
                }
                
                const service = document.getElementById('service').value;
                const date = document.getElementById('appointmentDate').value;
                const time = document.getElementById('appointmentTime').value;
                const message = document.getElementById('message').value;
                const submitBtn = document.getElementById('submitBtn');
                
                if (!service || !date || !time) {
                    showMessage(
                        currentLang === 'ca' ? 'Si us plau, ompliu tots els camps obligatoris' :
                        currentLang === 'es' ? 'Por favor, complete todos los campos obligatorios' :
                        currentLang === 'fr' ? 'Veuillez remplir tous les champs obligatoires' :
                        'Please fill in all required fields',
                        'error'
                    );
                    return;
                }
                
                submitBtn.disabled = true;
                submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> ' + (translations[currentLang]?.["form.submit"] || 'Confirm Appointment');
                
                try {
                    const appointment = {
                        userEmail: currentUser.email,
                        userName: `${currentUser.firstName} ${currentUser.lastName}`,
                        service: service,
                        date: date,
                        time: time,
                        message: message,
                        status: 'pending'
                    };
                    
                    await FirebaseManager.saveAppointment(appointment);
                    
                    showMessage(
                        currentLang === 'ca' ? 'Cita sol¬∑licitada correctament' :
                        currentLang === 'es' ? 'Cita solicitada correctamente' :
                        currentLang === 'fr' ? 'Rendez-vous demand√© avec succ√®s' :
                        'Appointment requested successfully',
                        'success'
                    );
                    
                    // Limpiar formulario
                    document.getElementById('appointmentForm').reset();
                    
                    // Actualizar lista de citas si est√° visible
                    if (document.getElementById('my-appointments').style.display === 'block') {
                        await loadUserAppointments();
                    }
                    
                } catch (error) {
                    console.error('Error guardando cita:', error);
                    showMessage(
                        currentLang === 'ca' ? 'Error sol¬∑licitant la cita' :
                        currentLang === 'es' ? 'Error solicitando la cita' :
                        currentLang === 'fr' ? 'Erreur lors de la demande de rendez-vous' :
                        'Error requesting appointment',
                        'error'
                    );
                }
                
                submitBtn.disabled = false;
                submitBtn.innerHTML = '<i class="fas fa-paper-plane"></i> ' + (translations[currentLang]?.["form.submit"] || 'Confirm Appointment');
            });
            
            // Charger les messages si l'utilisateur est connect√©
            const currentUser = UserManager.getCurrentUser();
            if (currentUser) {
                await loadUserMessages();
                startMessagesPolling();
            }
            
            // Configurar men√∫ m√≥vil
            document.querySelector('.mobile-menu-btn').addEventListener('click', function() {
                document.querySelector('.nav-links').classList.toggle('active');
            });
            
            console.log('üöÄ Sitio Lunagestio cargado - Con sistema completo de citas y autenticaci√≥n');
        });

        // Fermer le modal en cliquant √† l'ext√©rieur
        window.onclick = function(event) {
            const modal = document.getElementById('messagesModal');
            if (event.target === modal) {
                closeMessagesModal();
            }
        }

        // Funci√≥n de sincronizaci√≥n (placeholder)
        async function syncData() {
            showMessage(
                currentLang === 'ca' ? 'Sincronitzaci√≥ en curs...' :
                currentLang === 'es' ? 'Sincronizaci√≥n en curso...' :
                currentLang === 'fr' ? 'Synchronisation en cours...' :
                'Synchronization in progress...',
                'info'
            );
            
            // Simular sincronizaci√≥n
            setTimeout(() => {
                showMessage(
                    currentLang === 'ca' ? 'Dades sincronitzades correctament' :
                    currentLang === 'es' ? 'Datos sincronizados correctamente' :
                    currentLang === 'fr' ? 'Donn√©es synchronis√©es avec succ√®s' :
                    'Data synchronized successfully',
                    'success'
                );
            }, 1000);
        }
    </script>
</body>
</html>
